!function(){var r=/\s/g,d=/>/g,l=/</g;var s="__autosizeInputGhost";function c(){var e=document.createElement("div");return e.id=s,e.style.cssText="display:inline-block;height:0;overflow:hidden;position:absolute;top:0;visibility:hidden;white-space:nowrap;",document.body.appendChild(e),e}var f="";document.addEventListener("DOMContentLoaded",function(){f=c()}),window.autosizeInput=function(n,e){var t=window.getComputedStyle(n),i="box-sizing:"+t.boxSizing+";border-left:"+t.borderLeftWidth+" solid black;border-right:"+t.borderRightWidth+" solid black;font-family:"+t.fontFamily+";font-feature-settings:"+t.fontFeatureSettings+";font-kerning:"+t.fontKerning+";font-size:"+t.fontSize+";font-stretch:"+t.fontStretch+";font-style:"+t.fontStyle+";font-variant:"+t.fontVariant+";font-variant-caps:"+t.fontVariantCaps+";font-variant-ligatures:"+t.fontVariantLigatures+";font-variant-numeric:"+t.fontVariantNumeric+";font-weight:"+t.fontWeight+";letter-spacing:"+t.letterSpacing+";margin-left:"+t.marginLeft+";margin-right:"+t.marginRight+";padding-left:"+t.paddingLeft+";padding-right:"+t.paddingRight+";text-indent:"+t.textIndent+";text-transform:"+t.textTransform;function o(e){e=e||n.value||n.getAttribute("placeholder")||"",null===document.getElementById(s)&&(f=c()),f.style.cssText+=i,f.innerHTML=e.replace(r,"&nbsp;").replace(d,"&lt;").replace(l,"&gt;");var t=window.getComputedStyle(f).width;return n.style.width=t}n.addEventListener("input",function(){o()});var a=o();return e&&e.minWidth&&"0px"!==a&&(n.style.minWidth=a),o}}((window,document)),jQuery(function(d){d.fn.awesomeEditor=function(e){var n=this,i=d.extend({plugin:"Convert Forms Editor",debug:!0,form:n.find(".nrEditorOptions #adminForm"),root:n.data("root"),GoogleFonts:ConvertFormsGoogleFonts},e),t=new function(){var t=this;this.container=n.get(0),this.init=function(){var n=this;this.loadStylesheet("media/com_convertforms/css/convertforms.css"),document.addEventListener("click",function(e){var t=e.target.dataset.cfaction;if(t)switch(t){case"save":e.preventDefault(),n.save(e.target)}}),document.querySelectorAll(".field-media-wrapper > .modal").forEach(function(e){d(e).on("show.bs.modal",function(){d(e).appendTo("body")})})},this.initEditorFields=function(){tinyMCE.remove(),tinyMCE.init({init_instance_callback:function(e){e.on("ExecCommand",function(){tinyMCE.triggerSave(),a()}),e.on("blur",function(){tinyMCE.triggerSave(),a()})},content_css:i.root+"templates/system/css/editor.css",document_base_url:i.root,height:"170",plugins:"textcolor, code, colorpicker, fullscreen, link, image",selector:".editorx",toolbar1:"fontsizeselect styleselect link unlink image mybutton",toolbar2:"forecolor | bold italic underline | alignleft aligncenter alignright | code fullscreen",fontsize_formats:"10px 11px 12px 14px 16px 18px 20px 22px 24px 26px 28px 30px 32px 34px 36px 38px 40px 42px 46px 48px 50px 52px",mode:"specific_textareas",entity_encoding:"raw",forced_root_block:"",toolbar_items_size:"small",statusbar:!1,menubar:!1,inline_styles:!0,force_br_newlines:!1,relative_urls:!1,remove_script_host:!1,paste_data_images:!0,importcss_append:!0,image_advtab:!0,valid_children:"+div[style]"})},this.loadGoogleFont=function(e){-1<i.GoogleFonts.indexOf(e)&&this.loadStylesheet("//fonts.googleapis.com/css?family="+encodeURIComponent(e))},this.goToPanel=function(e,t){vv=n.find(".tabs-left ul li a[href=#"+e+"]"),vv.trigger("click"),n.find(".tab-content .accordion-group."+t+" .accordion-heading a.collapsed").trigger("click")},this.getFieldList=function(){var a=[];return this.container.querySelectorAll(".fmItem").forEach(function(e){var t,n,i,o=e.querySelector('input[name*="[name]"]');o&&(n=t=o.value,(i=e.querySelector('input[name*="[label]"]'))&&""!=i.value.length&&(n=i.value),a[t]=n)}),a},this.request=function(t){o[t.endpoint]||(o[t.endpoint]=!0,d(".loader").fadeIn(),t.beforeSend&&t.beforeSend(),fetch(i.root+"administrator/index.php?option=com_convertforms&tmpl=component&task=form."+t.endpoint,{method:"POST",credentials:"include",body:JSON.stringify(i.form.find("select, input[name*=jform], textarea").serializeArray()),headers:{"Content-type":"application/json; charset=UTF-8"}}).then(function(e){return o[t.endpoint]=!1,d(".loader").fadeOut(),t.complete&&t.complete(),"text"==t.type?e.text():e.json()}).then(function(e){if(e.error)throw new Error(e.error);t.success(e)}).catch(function(e){r(e)}))},this.save=function(e){t.request({endpoint:"ajaxSave",beforeSend:function(){Joomla.removeMessages(),e&&e.classList.add("working")},complete:function(){e&&e.classList.remove("working")},success:function(e){e.isNew&&(window.location.href=e.redirect.replace(/&amp;/g,"&"))}})},this.loadStylesheet=function(e){e=-1<e.indexOf("http")||-1<e.indexOf("//")?e:i.root+e,d("link[href='"+e+"']").length||d("head").append(d('<link rel="stylesheet" type="text/css" />').attr("href",e))},this.loadScript=function(e,t){var n;document.querySelector('script[src="'+e+'"]')?console.log("Script is already loaded",e):((n=document.createElement("script")).type="text/javascript",n.readyState?n.onreadystatechange=function(){"loaded"!=n.readyState&&"complete"!=n.readyState||(n.onreadystatechange=null,t())}:n.onload=function(){t()},e=-1<e.indexOf("http")||-1<e.indexOf("//")?e:i.root+e,n.src=e,document.getElementsByTagName("head")[0].appendChild(n))}};t.init();var o={};function a(){t.request({endpoint:"preview",success:function(e){d(".nrEditorPreviewContainer").html(e.html),d("#preview-successmsg").trigger("change")}})}function r(e){Joomla.renderMessages({error:[e]})}return n.on("renderForm",function(){a()}),n.on("error",function(e,t){r(t)}),d(document).on("click",".cf-control-group",function(){key=d(this).data("key"),n.trigger("controlGroupClick",[key])}),d(".page-title").click(function(){t.goToPanel("design","box"),d("#jform_name").focus()}),d(document).on("change",".nrEditorOptions input, .nrEditorOptions select, .nrEditorOptions textarea",function(e){var t;$el=d(e.target),$el.hasClass("norender")||(isColorPicker=$el.hasClass("minicolors-input"),isColorPicker?(t=0,clearTimeout(t),t=setTimeout(function(){a()},100)):a())}),d(document).on("subform-row-add subform-row-remove nrChoicesUpdate",function(){setTimeout(function(){a()},50)}),d(document).on("subform-row-add",function(){t.initEditorFields()}),d(document).on("submit",".cf form",function(){return!1}),d(window).on("load",function(){t.initEditorFields(),d("select.nrfont").change(function(){t.loadGoogleFont(d(this).val())}).trigger("change"),a()}),d("#preview-successmsg").change(function(){box=d(".nrEditorPreview .cf"),d(this).is(":checked")?(successMessage=d("#jform_successmsg").val(),box.find(".cf-response").html(successMessage),box.addClass("cf-success"),d("#jform_hideform0").is(":checked")?box.addClass("cf-success-hideform"):box.removeClass("cf-success-hideform")):box.removeClass("cf-success cf-error")}),window.ConvertFormsBuilder=t,this}}),jQuery(function(e){editor=e(".nrEditor"),editor.length&&editor.awesomeEditor()}),jQuery(function(t){t(document).on("click",".cf-layout-btn",function(){var e=t(this);container=e.closest(".control-group").find(".cf-layout-classes"),isVisible=container.is(":visible"),container.slideToggle(),e.text(isVisible?e.data("show-label"):e.data("hide-label"))}),t(document).on("click",".cf-layout-classes .cf-layout > span",function(){var e=t(this).closest(".control-group");input=e.find("input"),btn=e.find(".cf-layout-btn"),value=t.trim(input.val()),css_class=t(this).attr("class"),value=0<value.length?value+" ":value,input.val(value+css_class).trigger("change"),btn.trigger("click")})}),jQuery(function(l){var a=l(".fm");function i(e){var t=function(e){var t=document.querySelector('.fmItem[data-key="'+e+'"]'),n=t.querySelector('input[id$="_label"]');if(n&&n.value.trim())return n.value;var i=t.querySelector('input[id$="_text"]');if(i&&i.value)return i.value;var o=t.querySelector('input[id$="_name"]');return o&&o.value?o.value:t.querySelector("h3").firstChild.nodeValue}(e).trim();document.querySelector('.fmAddedFields .item[data-key="'+e+'"] .fmFieldLabel').innerHTML=t}function n(n){running||(running=!0,isCopy=void 0!==n.copyfield,a.addClass("disabled"),l.ajax({type:"POST",url:$builder.attr("data-root")+"administrator/index.php?option=com_convertforms&view=form&layout=field&format=raw",data:n,success:function(e){isCopy?a.find(".fmItems .fmItem[data-key="+n.copyfield+"]").after(e):a.find(".fmItems").append(e),$response=l(e),fieldKey=$response.attr("data-key"),fieldLabel=$response.attr("data-label"),$field=a.find(".fmAddedFields .item:last-child").clone().attr("data-key",fieldKey).find(".fmFieldLabel").html(fieldLabel).end(),isCopy?$field.insertAfter(".fmAddedFields .item[data-key="+n.copyfield+"]"):$field.appendTo(".fmAddedFields"),a.trigger("afterAddField",[a.attr("data-nextid")]).trigger("fieldsUpdate");var t=new CustomEvent("AfterFieldAdd",{detail:{field_key:fieldKey}});builder.dispatchEvent(t),i(fieldKey),s.emitEvent("update")},error:function(e,t,n){$builder.trigger("error",n)},complete:function(){running=!1,a.removeClass("disabled")}}))}function o(e){builder.querySelector('.tabs-left ul li a[href="#fields"]').click(),r("fmItems"),a.find(".fmItem").hide().filter("[data-key="+e+"]").show();var t={id:e,el:document.querySelector('.fmItem[data-key="'+e+'"]')};s.emitEvent("displayOptions",t)}function r(e){$tab.find('li a[href="#'+e+'"]').tab("show")}function d(e){return e=void 0===e?a.attr("data-nextid"):e,a.attr("data-formcontrol").replace("X",e)}$builder=l(".nrEditor"),builder=$builder.get(0),$tab=l("#fieldsManagerTabs"),running=!1,isJ4=Joomla.hasOwnProperty("Event"),function(){if(el=l(".fmAddedFields"),0==el.length)return;new Sortable(el.get(0),{animation:150,ghostClass:"ghost-item",onUpdate:function(){var e;(e=a.find(".fmItems")).find(".fmItem").sort(function(e,t){return l(".fmAddedFields .item[data-key="+l(e).attr("data-key")+"]").index()-l(".fmAddedFields .item[data-key="+l(t).attr("data-key")+"]").index()}).appendTo(e),a.trigger("fieldsUpdate"),ConvertFormsBuilder.initEditorFields(),s.emitEvent("update")}})}(),document.querySelectorAll(".fmItems .fmItem").forEach(function(e){i(e.dataset.key)}),a.find(".addField").on("click",function(e){var t;void 0===l(this).attr("data-pro-only")&&n({field:{type:t=l(this).attr("data-type"),key:a.attr("data-nextid"),name:t+"_"+a.attr("data-nextid"),label:l.trim(l(this).text())},formcontrol:encodeURIComponent(d())})}),l(document).on("click",".fmAddedFields .item",function(){o(l(this).attr("data-key")),r("fmItems")}),l(document).on("click",".removeField",function(){var e,t,n=l(this);return confirm("Are you sure")&&(e=n.closest("div").attr("data-key"),t=e,a.find(".fmAddedFields > .item[data-key="+t+"]").remove(),a.find(".fmItem[data-key="+t+"]").remove(),a.trigger("fieldsUpdate"),s.emitEvent("update"),n.data("focusnext")&&((e=a.find(".fmItems > .fmItem:first-child").attr("data-key"))?o(e):r("fmaddField"))),!1}),l(document).on("click",".copyField",function(){return function(e){var t=a.find(".fmItems > .fmItem[data-key="+e+"]");field_type=t.find("input[id$=_type]").val(),field_data=t.find("input, select, textarea"),formControl=d(e);var o={};l.map(field_data.serializeArray(),function(e,t){var n=e.name.replace(formControl,"field"),i=e.value;"field[name]"==n&&(i+="_copy"+Math.random().toString(36).substr(2,4)),"field[key]"==n&&(i=a.attr("data-nextid")),o[n]=i}),o.formcontrol=encodeURIComponent(d()),o.copyfield=e,n(o)}(l(this).closest("div").attr("data-key")),!1}),a.on("fieldsUpdate",function(e){$builder.trigger("renderForm")}),a.on("afterAddField",function(){key=parseInt(a.attr("data-nextid"));var e,t=l(".fmItem[data-key="+key+"]");o(key),a.find(".hasPopover").popover({html:!0,trigger:"hover focus",container:"body"}),isJ4?(Joomla.Event.dispatch(t.get(0),"joomla:updated"),ConvertFormsBuilder.initEditorFields()):(l(document).trigger("subform-row-add"),e=(e=t)||document,l(e).find(".minicolors").each(function(){var e=l(this),t="color"!==e.data("validate")&&e.data("format")||"hex";e.minicolors({control:e.data("control")||"hue",format:"rgba"===t?"rgb":t,keywords:e.data("keywords")||"",opacity:"rgba"===t,position:e.data("position")||"default",theme:e.data("theme")||"bootstrap"})})),key+=1,a.attr("data-nextid",key)}),$builder.on("controlGroupClick",function(e,t){o(t)}),document.addEventListener("change",function(e){var t=e.target.closest(".fmItem");t&&(i(t.dataset.key),s.emitEvent("update"))});var s={emitEvent:function(e,t){builder.dispatchEvent(new CustomEvent("fields."+e,{detail:t}))},getFieldsArray:function(){var e=l(".fmItems .fmItem");if(e.length){var d=[];return e.each(function(){var e,t=l(this),n=t.find("input[id$=__name]").val(),i=t.find("input[id$=__type]").val(),o=t.data("key"),a=t.find("input[id$=__label]").val(),r={id:o,name:n,label:a=(a=(a=a||l(".fmAddedFields .item[data-key="+o+"]").find(".fmFieldLabel strong").text())||n)||i.charAt(0).toUpperCase()+i.slice(1),type:i};["radio","dropdown","checkbox"].includes(i)&&((e=document.querySelector('.fmItems .fmItem[data-key="'+o+'"]').querySelector(".nr_choices").querySelectorAll(".nr-choice-item"))&&(r.options=[]),e.forEach(function(e){var t,n=e.querySelector(".nr-choice-label").value;n&&(t=e.querySelector(".nr-choice-value").value,r.options.push({label:n,value:t||n}))})),d.push(r)}),d}}};window.ConvertFormsBuilder.FieldsHelper=s}),document.addEventListener("DOMContentLoaded",function(){var t=document.querySelector("#formname"),e=document.querySelector("#jform_name");autosizeInput(t),changeValue=function(e){t.value=e,t.dispatchEvent(new Event("change")),t.dispatchEvent(new Event("input"))},t.addEventListener("input",function(){e.value=this.value}),t.addEventListener("blur",function(){this.value||changeValue(this.dataset.fallback)}),e.addEventListener("input",function(){changeValue(this.value)})}),jQuery(function(d){var e=d(".st");d(".fm").on("fieldsUpdate",function(){e.trigger("update")}),d(document).on("subform-row-add",function(){e.trigger("update")}),d(document).on("smartTagsBoxBeforeRender",function(e,t,n){var a,i,o,r=n.closest(".fmItem").length;skipFields=-1<["jform_text","jform_footer"].indexOf(n.prev().attr("id")),skip=r||skipFields,skip||(a={},i={Submission:{"{submission.id}":Joomla.JText._("COM_CONVERTFORMS_SUBMISSION_ID"),"{submission.date}":Joomla.JText._("COM_CONVERTFORMS_SUBMISSION_DATE"),"{submission.campaign_id}":Joomla.JText._("COM_CONVERTFORMS_SUBMISSION_CAMPAIGN_ID"),"{submission.form_id}":Joomla.JText._("COM_CONVERTFORMS_SUBMISSION_FORM_ID"),"{submission.visitor_id}":Joomla.JText._("COM_CONVERTFORMS_SUBMISSION_VISITOR_ID"),"{submissions.count}":Joomla.JText._("COM_CONVERTFORMS_SUBMISSIONS_COUNT")}},(o=d(".fmItems .fmItem")).length&&(o.each(function(){var e=d(this),t=e.find("input[id$=__name]").val();if(!t)return!0;var n=e.find("input[id$=__label]").val(),i=e.find("input[id$=__type]").val(),o=e.data("key");(n=n||d(".fmAddedFields .item[data-key="+o+"]").find(".fmFieldLabel strong").text())||(field_type_name=i.charAt(0).toUpperCase()+i.slice(1),n=field_type_name+" #"+o),name="{field."+t+"}",a[name]=n,"dropdown"!=i&&"radio"!=i||(a["{field."+t+".label}"]=n+" Label")}),a["{all_fields}"]=Joomla.JText._("COM_CONVERTFORMS_ALL_FIELDS"),a["{all_fields_filled}"]=Joomla.JText._("COM_CONVERTFORMS_ALL_FILLED_ONLY_FIELDS"),i.Fields=a,d.extend(!0,t,i)))})}),jQuery(function(e){var t=e(".nrEditor");function n(){if(state=function(){if($tabs=t.find(".nav-tabs"),0!=$tabs.children().length)return tab=$tabs.find("li.active a").attr("href").replace("#",""),panel=t.find(".tab-pane#"+tab+" .accordion-body.in.collapse"),panel=panel.length?(panel=panel.parent().attr("class").split(" "),panel[1]):"",tab+"-"+panel}(),null!=state){formID=t.find("form").attr("pk");try{Cookies.set("ConvertFormsState"+formID,state)}catch(e){console.log(e)}}}document.querySelector("body.task-display")||(t.find(".accordion").on("shown.bs.collapse hidden.bs.collapse",function(){n()}),t.find(".nav-tabs").on("shown.bs.tab",function(){n()}))});
