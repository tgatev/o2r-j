!function(){var a=/\s/g,d=/>/g,s=/</g;var l="__autosizeInputGhost";function c(){var e=document.createElement("div");return e.id=l,e.style.cssText="display:inline-block;height:0;overflow:hidden;position:absolute;top:0;visibility:hidden;white-space:nowrap;",document.body.appendChild(e),e}var f="";document.addEventListener("DOMContentLoaded",function(){f=c()}),window.autosizeInput=function(n,e){var t=window.getComputedStyle(n),i="box-sizing:"+t.boxSizing+";border-left:"+t.borderLeftWidth+" solid black;border-right:"+t.borderRightWidth+" solid black;font-family:"+t.fontFamily+";font-feature-settings:"+t.fontFeatureSettings+";font-kerning:"+t.fontKerning+";font-size:"+t.fontSize+";font-stretch:"+t.fontStretch+";font-style:"+t.fontStyle+";font-variant:"+t.fontVariant+";font-variant-caps:"+t.fontVariantCaps+";font-variant-ligatures:"+t.fontVariantLigatures+";font-variant-numeric:"+t.fontVariantNumeric+";font-weight:"+t.fontWeight+";letter-spacing:"+t.letterSpacing+";margin-left:"+t.marginLeft+";margin-right:"+t.marginRight+";padding-left:"+t.paddingLeft+";padding-right:"+t.paddingRight+";text-indent:"+t.textIndent+";text-transform:"+t.textTransform;function o(e){e=e||n.value||n.getAttribute("placeholder")||"",null===document.getElementById(l)&&(f=c()),f.style.cssText+=i,f.innerHTML=function(e){return e.replace(a,"&nbsp;").replace(d,"&lt;").replace(s,"&gt;")}(e);var t=window.getComputedStyle(f).width;return n.style.width=t}n.addEventListener("input",function(){o()});var r=o();return e&&e.minWidth&&"0px"!==r&&(n.style.minWidth=r),o}}(window,document),jQuery(function(l){l.fn.awesomeEditor=function(e){var n=this,i=l.extend({plugin:"Convert Forms Editor",debug:!0,form:n.find(".nrEditorOptions #adminForm"),root:n.data("root"),GoogleFonts:ConvertFormsGoogleFonts},e),t=new function(){this.container=n.get(0),this.init=function(){d(i.root+"media/com_convertforms/css/convertforms.css"),document.querySelectorAll(".field-media-wrapper > .modal").forEach(function(e){l(e).on("show.bs.modal",function(){l(e).appendTo("body")})})},this.initEditorFields=function(){tinyMCE.remove(),tinyMCE.init({init_instance_callback:function(e){e.on("ExecCommand",function(){tinyMCE.triggerSave(),a()}),e.on("blur",function(){tinyMCE.triggerSave(),a()})},content_css:i.root+"templates/system/css/editor.css",document_base_url:i.root,height:"170",plugins:"textcolor, code, colorpicker, fullscreen, link, image",selector:".editorx",toolbar1:"fontsizeselect styleselect link unlink image mybutton",toolbar2:"forecolor | bold italic underline | alignleft aligncenter alignright | code fullscreen",fontsize_formats:"10px 11px 12px 14px 16px 18px 20px 22px 24px 26px 28px 30px 32px 34px 36px 38px 40px 42px 46px 48px 50px 52px",mode:"specific_textareas",entity_encoding:"raw",forced_root_block:"",toolbar_items_size:"small",statusbar:!1,menubar:!1,inline_styles:!0,force_br_newlines:!1,relative_urls:!1,remove_script_host:!1,paste_data_images:!0,importcss_append:!0,image_advtab:!0,valid_children:"+div[style]"})},this.loadGoogleFont=function(e){-1<i.GoogleFonts.indexOf(e)&&d("//fonts.googleapis.com/css?family="+encodeURIComponent(e))},this.goToPanel=function(e,t){n.find(".nav-tabs li a[href=#"+e+"]").trigger("click"),n.find(".tab-content .accordion-group."+t+" .accordion-heading a.collapsed").trigger("click")},this.getFieldList=function(){var r=[];return this.container.querySelectorAll(".fmItem").forEach(function(e){var t=e.querySelector('input[name*="[name]"]');if(t){var n=t.value,i=n,o=e.querySelector('input[name*="[label]"]');o&&""!=o.value.length&&(i=o.value),r[n]=i}}),r}};t.init();var o={};function r(t){o[t.endpoint]||(o[t.endpoint]=!0,l(".loader").fadeIn(),t.beforeSend&&t.beforeSend(),fetch(i.root+"administrator/index.php?option=com_convertforms&tmpl=component&task=form."+t.endpoint,{method:"POST",credentials:"include",body:JSON.stringify(i.form.find("select, input[name*=jform], textarea").serializeArray()),headers:{"Content-type":"application/json; charset=UTF-8"}}).then(function(e){if(o[t.endpoint]=!1,l(".loader").fadeOut(),t.complete&&t.complete(),!e.ok)throw new Error(e.statusText);return"text"==t.type?e.text():e.json()}).then(function(e){t.success(e)}).catch(function(e){s(e)}))}function a(){r({endpoint:"preview",success:function(e){l(".nrEditorPreviewContainer").html(e.html),l("#preview-successmsg").trigger("change")}})}function d(e){l("link[href='"+e+"']").length||l("head").append(l('<link rel="stylesheet" type="text/css" />').attr("href",e))}function s(e){Joomla.renderMessages({error:[e]})}return n.on("renderForm",function(){a()}),n.on("error",function(e,t){s(t)}),l(document).on("click",".cf-control-group",function(){key=l(this).data("key"),n.trigger("controlGroupClick",[key])}),l(".page-title").click(function(){t.goToPanel("design","box"),l("#jform_name").focus()}),l(document).on("change",".nrEditorOptions input, .nrEditorOptions select, .nrEditorOptions textarea",function(e){$el=l(e.target),$el.hasClass("norender")||(isColorPicker=$el.hasClass("minicolors-input"),isColorPicker?function(){var n=0;return function(e,t){clearTimeout(n),n=setTimeout(e,t)}}()(function(){a()},100):a())}),l(document).on("subform-row-add subform-row-remove nrChoicesUpdate",function(){setTimeout(function(){a()},50)}),l(document).on("subform-row-add",function(){t.initEditorFields()}),l(document).on("submit",".cf form",function(){return!1}),l(window).load(function(){t.initEditorFields(),l("select.nrfont").change(function(){t.loadGoogleFont(l(this).val())}).trigger("change"),a()}),document.querySelector(".save").addEventListener("click",function(e){e.preventDefault(),r({endpoint:"ajaxSave",beforeSend:function(){l(".save").addClass("working")},complete:function(){l(".save").removeClass("working")},success:function(e){e.isNew&&(window.location.href=e.redirect.replace(/&amp;/g,"&"))}})}),l("#preview-successmsg").change(function(){box=l(".nrEditorPreview .cf"),l(this).is(":checked")?(successMessage=l("#jform_successmsg").val(),box.find(".cf-response").html(successMessage),box.addClass("cf-success"),l("#jform_hideform0").is(":checked")?box.addClass("cf-success-hideform"):box.removeClass("cf-success-hideform")):box.removeClass("cf-success cf-error")}),window.ConvertFormsBuilder=t,this}}),jQuery(function(e){editor=e(".nrEditor"),editor.length&&editor.awesomeEditor()}),jQuery(function(t){t(document).on("click",".cf-layout-btn",function(){var e=t(this);container=e.closest(".control-group").find(".cf-layout-classes"),isVisible=container.is(":visible"),container.slideToggle(),e.text(isVisible?e.data("show-label"):e.data("hide-label"))}),t(document).on("click",".cf-layout-classes .cf-layout > span",function(){var e=t(this).closest(".control-group").find("input");value=t.trim(e.val()),css_class=t(this).attr("class"),value=0<value.length?value+" ":value,e.val(value+css_class).trigger("change"),t(".cf-layout-btn").trigger("click")})}),jQuery(function(i){var r=i(".fm");function o(e){var t=function(e){var t=document.querySelector('.fmItem[data-key="'+e+'"]'),n=t.querySelector('input[id$="_label"]');if(n&&n.value.trim())return n.value;var i=t.querySelector('input[id$="_text"]');if(i&&i.value)return i.value;var o=t.querySelector('input[id$="_name"]');return o&&o.value?o.value:t.querySelector("h3").firstChild.nodeValue}(e).trim();document.querySelector('.fmAddedFields .item[data-key="'+e+'"] .fmFieldLabel').innerHTML=t}function n(n){running||(running=!0,isCopy=void 0!==n.copyfield,r.addClass("disabled"),i.ajax({type:"POST",url:$builder.attr("data-root")+"administrator/index.php?option=com_convertforms&view=form&layout=field&format=raw",data:n,success:function(e){isCopy?r.find(".fmItems .fmItem[data-key="+n.copyfield+"]").after(e):r.find(".fmItems").append(e),$response=i(e),fieldKey=$response.attr("data-key"),fieldLabel=$response.attr("data-label"),$field=r.find(".fmAddedFields .item:last-child").clone().attr("data-key",fieldKey).find(".fmFieldLabel").html(fieldLabel).end(),isCopy?$field.insertAfter(".fmAddedFields .item[data-key="+n.copyfield+"]"):$field.appendTo(".fmAddedFields"),r.trigger("afterAddField",[r.attr("data-nextid")]).trigger("update");var t=new CustomEvent("AfterFieldAdd",{detail:{field_key:fieldKey}});builder.dispatchEvent(t),o(fieldKey)},error:function(e,t,n){$builder.trigger("error",n)},complete:function(){running=!1,r.removeClass("disabled")}}))}function a(e){$builder.find("#sectionsTabs li a[href=#fields]").trigger("click"),d("fmItems"),r.find(".fmItem").hide().filter("[data-key="+e+"]").show(),r.trigger("afterShowField",[e])}function d(e){$tab.find('li a[href="#'+e+'"]').tab("show")}function s(e){return e=void 0===e?r.attr("data-nextid"):e,r.attr("data-formcontrol").replace("X",e)}$builder=i(".nrEditor"),builder=$builder.get(0),$tab=i("#fieldsManagerTabs"),running=!1,function(){if(el=i(".fmAddedFields"),0==el.length)return;el.sortable({update:function(e,t){!function(){var e=r.find(".fmItems");e.find(".fmItem").sort(function(e,t){return i(".fmAddedFields .item[data-key="+i(e).attr("data-key")+"]").index()-i(".fmAddedFields .item[data-key="+i(t).attr("data-key")+"]").index()}).appendTo(e)}(),r.trigger("update"),ConvertFormsBuilder.initEditorFields()}})}(),document.querySelectorAll(".fmItems .fmItem").forEach(function(e){o(e.dataset.key)}),r.find(".addField").on("click",function(e){if(void 0===i(this).attr("data-pro-only")){var t=i(this).attr("data-type");n({field:{type:t,key:r.attr("data-nextid"),name:t+"_"+r.attr("data-nextid"),label:i.trim(i(this).text())},formcontrol:encodeURIComponent(s())})}}),i(document).on("click",".fmAddedFields .item",function(){a(i(this).attr("data-key")),d("fmItems")}),i(document).on("click",".removeField",function(){var e=i(this);if(confirm("Are you sure")){var t=e.closest("div").attr("data-key");!function(e){r.find(".fmAddedFields > .item[data-key="+e+"]").remove(),r.find(".fmItem[data-key="+e+"]").remove(),r.trigger("update")}(t),e.data("focusnext")&&((t=r.find(".fmItems > .fmItem:first-child").attr("data-key"))?a(t):d("fmaddField"))}return!1}),i(document).on("click",".copyField",function(){return function(e){var t=r.find(".fmItems > .fmItem[data-key="+e+"]");field_type=t.find("input[id$=_type]").val(),field_data=t.find("input, select, textarea"),formControl=s(e);var o={};i.map(field_data.serializeArray(),function(e,t){var n=e.name.replace(formControl,"field"),i=e.value;"field[name]"==n&&(i+="_copy"),"field[key]"==n&&(i=r.attr("data-nextid")),o[n]=i}),o.formcontrol=encodeURIComponent(s()),o.copyfield=e,n(o)}(i(this).closest("div").attr("data-key")),!1}),r.on("update",function(){$builder.trigger("renderForm")}),r.on("afterAddField",function(){key=parseInt(r.attr("data-nextid"));var e=i(".fmItem[data-key="+key+"]");a(key),r.find(".hasPopover").popover({html:!0,trigger:"hover focus",container:"body"}),i(document).trigger("subform-row-add"),function(e){e=e||document,i(e).find(".minicolors").each(function(){var e=i(this),t="color"===e.data("validate")?"hex":e.data("format")||"hex";e.minicolors({control:e.data("control")||"hue",format:"rgba"===t?"rgb":t,keywords:e.data("keywords")||"",opacity:"rgba"===t,position:e.data("position")||"default",theme:e.data("theme")||"bootstrap"})})}(e),key+=1,r.attr("data-nextid",key)}),r.on("afterShowField",function(e,t){$builder.find(".cf-control-group").removeClass("active").filter("[data-key="+t+"]").addClass("active")}),$builder.on("controlGroupClick",function(e,t){a(t)}),document.addEventListener("change",function(e){var t=e.target.closest(".fmItem");t&&o(t.dataset.key)})}),document.addEventListener("DOMContentLoaded",function(){var t=document.querySelector("#formname"),e=document.querySelector("#jform_name");autosizeInput(t),changeValue=function(e){t.value=e,t.dispatchEvent(new Event("change")),t.dispatchEvent(new Event("input"))},t.addEventListener("input",function(){e.value=this.value}),t.addEventListener("blur",function(){this.value||changeValue(this.dataset.fallback)}),e.addEventListener("input",function(){changeValue(this.value)})}),jQuery(function(d){var e=d(".st");d(".fm").on("update",function(){e.trigger("update")}),d(document).on("subform-row-add",function(){e.trigger("update")}),d(document).on("smartTagsBoxBeforeRender",function(e,t,n){var i=n.closest(".fmItem").length;if(skipFields=-1<["jform_text","jform_footer"].indexOf(n.prev().attr("id")),skip=i||skipFields,!skip){var r={},o={Submission:{"{submission.id}":"Submission ID","{submission.date}":"Submission Date","{submission.campaign_id}":"Submission Campaign ID","{submission.form_id}":"Submission Form ID","{submission.visitor_id}":"Submission Visitor ID","{submissions.count}":"Submissions Count"}},a=d(".fmItems .fmItem");a.length&&(a.each(function(){var e=d(this),t=e.find("input[id$=__name]").val();if(!t)return!0;var n=e.find("input[id$=__label]").val(),i=e.find("input[id$=__type]").val(),o=e.data("key");(n=n||d(".fmAddedFields .item[data-key="+o+"]").find(".fmFieldLabel strong").text())||(field_type_name=i.charAt(0).toUpperCase()+i.slice(1),n=field_type_name+" #"+o),name="{field."+t+"}",r[name]=n,"dropdown"!=i&&"radio"!=i||(r["{field."+t+".label}"]=n+" Label")}),r["{all_fields}"]="All Fields",r["{all_fields_filled}"]="All Filled-only Fields",o.Fields=r,d.extend(!0,t,o))}})}),jQuery(function(e){var t=e(".nrEditor");function n(){if(state=function(){if($tabs=t.find(".nav-tabs"),0!=$tabs.children().length)return tab=$tabs.find("li.active a").attr("href").replace("#",""),panel=t.find(".tab-pane#"+tab+" .accordion-body.in.collapse"),panel.length?(panel=panel.parent().attr("class").split(" "),panel=panel[1]):panel="",tab+"-"+panel}(),null!=state){formID=t.find("form").attr("pk");try{Cookies.set("ConvertFormsState"+formID,state)}catch(e){console.log(e)}}}t.find(".accordion").on("shown.bs.collapse hidden.bs.collapse",function(){n()}),t.find(".nav-tabs").on("shown.bs.tab",function(){n()})});
